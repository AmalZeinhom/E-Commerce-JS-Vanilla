<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products</title>
    <link rel="icon" type="image/png" href="../assets/images/logo.png" />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link rel="stylesheet" href="../CSS/bootstrap.min.css" />
    <link rel="stylesheet" href="../CSS/navbar.css" />
    <link rel="stylesheet" href="../CSS/loader.css" />
    <link rel="stylesheet" href="../CSS/products.css" />
  </head>

  <body>
    <div class="loader-container" id="loader">
      <span class="loader"></span>
    </div>

    <header>
      <nav class="navbar">
        <a href="../index.html" class="logo">
          <img src="../assets/images/logo.png" alt="Shopping" />
        </a>

        <button class="menu-toggle" id="menu-toggle">‚ò∞</button>

        <div class="links" id="nav-links">
          <ul>
            <li><a href="../index.html">Home</a></li>
            <li>
              <a href="../Pages/products.html" class="active">Products</a>
            </li>
            <li><a href="../Pages/admin.html">Admin</a></li>
            <li><a href="../Pages/create.html">Create</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <!-- ========== Products Section ========== -->
    <main class="products-page">
      <div class="container">
        <h1 class="section-title">Explore Our Products</h1>
        <div class="filter-section">
          <form class="filter-form">
            <select id="categoryFilter">
              <option value="" class="allCategories">All Categories</option>
            </select>

            <input
              type="number"
              id="minPrice"
              placeholder="Min Price"
              min="0"
            />
            <input
              type="number"
              id="maxPrice"
              placeholder="Max Price"
              min="0"
            />

            <button type="button" class="btn btn-apply">Apply</button>
            <button type="reset" class="btn btn-reset">Reset</button>
          </form>
        </div>

        <div id="rowData" class="product-grid"></div>

        <!-- Pagination -->
        <div class="pagination">
          <button id="prevBtn" class="btn-pagination">Previous</button>
          <button id="nextBtn" class="btn-pagination">Next</button>
        </div>
      </div>
    </main>

    <!-- ========== Footer ========== -->
    <footer>
      <p>¬© 2025 MyShop ‚Äî Built with ‚ù§Ô∏è using JavaScript & Bootstrap</p>
    </footer>

    <script src="../JS/bootstrap.bundle.min.js"></script>
    <script>
      const menuToggle = document.getElementById("menu-toggle");
      const navLinks = document.getElementById("nav-links");
      const loader = document.getElementById("loader");

      menuToggle.addEventListener("click", () => {
        navLinks.classList.toggle("active");
      });

      function showLoader() {
        loader.style.display = "flex";
        loader.classList.remove("hide");
      }

      function hideLoader() {
        loader.classList.add("hide");
        setTimeout(() => {
          loader.style.display = "none";
        }, 1200);
      }

      let page = 1;
      const limit = 12;

      async function fetchCategories() {
        showLoader();
        try {
          const res = await fetch("https://api.escuelajs.co/api/v1/categories");
          const categories = await res.json();

          const select = document.getElementById("categoryFilter");
          select.innerHTML = `<option value="">All Categories</option>`;
          categories.forEach((c) => {
            const opt = document.createElement("option");
            opt.value = c.id;
            opt.textContent = c.name;
            select.appendChild(opt);
          });
        } catch (err) {
          console.error("Error loading categories:", err);
        } finally {
          hideLoader();
        }
      }

      async function fetchProducts() {
        showLoader();
        try {
          const offset = (page - 1) * limit;
          let category = document.getElementById("categoryFilter").value;
          let url = `https://api.escuelajs.co/api/v1/products?offset=${offset}&limit=${limit}`;

          if (category) {
            url = `https://api.escuelajs.co/api/v1/categories/${category}/products`;
          }

          const res = await fetch(url);
          let data = await res.json();

          // Filter by price
          const min =
            parseFloat(document.getElementById("minPrice").value) || 0;
          const max =
            parseFloat(document.getElementById("maxPrice").value) || Infinity;
          data = data.filter((p) => p.price >= min && p.price <= max);

          displayProducts(data);
        } catch (err) {
          console.error("Error loading products:", err);
          document.getElementById(
            "rowData"
          ).innerHTML = `<p class="text-danger text-center">Failed to load products</p>`;
        } finally {
          setTimeout(() => hideLoader(), 300);
        }
      }

      // ‚úÖ Display Products
      function displayProducts(products) {
        const container = document.getElementById("rowData");
        container.innerHTML = "";

        if (products.length === 0) {
          container.innerHTML = `<p class="no-products">No products found üõí</p>`;
          return;
        }

        products.forEach((p) => {
          const card = document.createElement("div");
          const imageSrc =
            p.images && p.images.length > 0 && p.images[0].startsWith("http")
              ? p.images[0]
              : "../assets/images/no-image.png";
          card.className = "product-card";
          card.innerHTML = `
        <a href="./product-details.html?id=${
          p.id
        }" class="text-decoration-none">
          <img src="${imageSrc}" alt="${p.title}" />
          <h3>${p.title}</h3>
          <span class="category">${p.category?.name || "Unknown"}</span>
          <p class="price">$${p.price}</p>
        </a>
      `;
          container.appendChild(card);
        });
      }

      // ‚úÖ Event Listeners
      document.querySelector(".btn-apply").addEventListener("click", () => {
        page = 1;
        fetchProducts();
      });

      document.querySelector(".btn-reset").addEventListener("click", () => {
        document.getElementById("categoryFilter").value = "";
        document.getElementById("minPrice").value = "";
        document.getElementById("maxPrice").value = "";
        fetchProducts();
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        page++;
        fetchProducts();
      });

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (page > 1) {
          page--;
          fetchProducts();
        }
      });

      // ‚úÖ Initialize
      fetchCategories();
      fetchProducts();
    </script>
  </body>
</html>
